@page "/"

@using MyApplication.Interfaces
@using MyApplication.Entities
@inject IRepositoryFestival FestivalRepository
@inject ICloudinaryService CloudinaryService

@if (Images != null && Images.Count > 0)
{
    <MudCarousel TData="string" ShowArrows="true" AutoCycle="true" Class="custom-carousel" Style="height:350px; width:100%;">
        @foreach (var image in Images)
        {
            <MudCarouselItem>
                <div class="d-flex justify-center align-center" style="height:100%; width:100%;">
                    <img src="@image"
                         style="width:100%; height:100%; object-fit:contain; cursor:pointer;"
                         @onclick="() => OnImageClick(Images.IndexOf(image))" />
                </div>
            </MudCarouselItem>
        }
    </MudCarousel>
}

@code {
    List<string> Images { get; set; } = new();

    protected override async Task OnInitializedAsync()
    {
        var festivals = await FestivalRepository.GetAllAsync();
        Images = festivals
            .Where(f => !string.IsNullOrEmpty(f.PublicId))
            .Select(f => CloudinaryService.GetTransformedImageUrl(f.PublicId!, 2000, 350))
            .ToList();
    }

    void OnImageClick(int index)
    {
        if (index >= 0 && index < Images.Count)
        {
            Console.WriteLine($"Image {index} clicked!");
        }
    }
}